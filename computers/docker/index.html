
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Apunts i notes de coses que aprenc">
      
      
        <meta name="author" content="vokimon">
      
      
        <link rel="canonical" href="https://vokimon.github.io/apunts/computers/docker/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.8">
    
    
      
        <title>Docker - Apunts</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.815d1a91.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/figure.css">
    
      <link rel="stylesheet" href="../../css/linkcard.css">
    
      <link rel="stylesheet" href="../../css/videowrapper.css">
    
      <link rel="stylesheet" href="../..">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Apunts" class="md-header__button md-logo" aria-label="Apunts" data-md-component="logo">
      
  <img src="../../img/logo-customblocks-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apunts
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vokimon/apunts" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Apunts" class="md-nav__button md-logo" aria-label="Apunts" data-md-component="logo">
      
  <img src="../../img/logo-customblocks-white.svg" alt="logo">

    </a>
    Apunts
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vokimon/apunts" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        README
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Computers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Computers" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Computers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          css
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="css" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          css
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css-boxmodel/" class="md-nav__link">
        El modelo de caja
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css-normalflow/" class="md-nav__link">
        Flujo normal (normal flow)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css-flexbox/" class="md-nav__link">
        CSS Flexbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css-grid/" class="md-nav__link">
        CSS Grid
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../css-typography/" class="md-nav__link">
        Css typography
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          javascript
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="javascript" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          javascript
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jsecosystem/" class="md-nav__link">
        Jsecosystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jsonschema/" class="md-nav__link">
        Jsonschema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../react-formik/" class="md-nav__link">
        React formik
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../react/" class="md-nav__link">
        React / Redux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../android-glossary/" class="md-nav__link">
        Android glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpp11/" class="md-nav__link">
        New features of C++11 I should be starting to use:
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deeplearning/" class="md-nav__link">
        Deep learning
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Docker
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#que-es" class="md-nav__link">
    Qué ès?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    Containers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imatges" class="md-nav__link">
    Imatges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environ" class="md-nav__link">
    Environ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multistage-build" class="md-nav__link">
    Multistage build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xarxa" class="md-nav__link">
    Xarxa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reinici-automatic" class="md-nav__link">
    Reinici automàtic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursos" class="md-nav__link">
    Recursos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumenes" class="md-nav__link">
    Volúmenes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicacion" class="md-nav__link">
    Publicacion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composicion-de-servicios" class="md-nav__link">
    Composición de servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#componiendo-para-multiples-entornos" class="md-nav__link">
    Componiendo para multiples entornos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking-en-compose" class="md-nav__link">
    Networking en compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-en-produccion" class="md-nav__link">
    Docker en producción?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consejos" class="md-nav__link">
    Consejos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-siempre-tengo-la-ultima-version" class="md-nav__link">
    - Siempre tengo la ultima version
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ip6" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../specs-pdf/" class="md-nav__link">
        Specs pdf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../timewarrior/" class="md-nav__link">
        TimeWarrior
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../xpxplained/" class="md-nav__link">
        XP Explained (Extracto del libro)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Math
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Math" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Math
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/mates-fundation/" class="md-nav__link">
        Math Foundations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/math-halfderivatives/" class="md-nav__link">
        Half Derivatives
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/math-quadraticformula-alternative/" class="md-nav__link">
        Quadratic Formula
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/math-wavelets/" class="md-nav__link">
        Wavelets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math/math-3n1/" class="md-nav__link">
        Collatz Conjecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Music
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Music" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Music
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/music-harmony/" class="md-nav__link">
        Harmony: Notes, Scales and Chords 🎶
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/guitar-technics/" class="md-nav__link">
        Técnica de Guitarra 🎸
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/guitar-fret-navigation/" class="md-nav__link">
        Navegación en el mástil
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/pentatonicas.txt" class="md-nav__link">
        Pentatonicas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/songs/" class="md-nav__link">
        Songs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../music/ukelele/" class="md-nav__link">
        Ukelele
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Languages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Languages" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Languages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/consonantes-afi.png" class="md-nav__link">
        Phonetics Consonants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/vowels.jpg" class="md-nav__link">
        Phonetics Vowels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/arabic-alphabet/" class="md-nav__link">
        Arabic script
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/arabic/" class="md-nav__link">
        Arabic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/deutsch/" class="md-nav__link">
        Deutsch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/english-expresions/" class="md-nav__link">
        English expresions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/english-old-pronoums/" class="md-nav__link">
        English old pronoums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/english-prepositions/" class="md-nav__link">
        English prepositions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/english-tenses/" class="md-nav__link">
        English tenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/vocabulary-somenergia/" class="md-nav__link">
        English Vocabulary for SE enterviews
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lang/vocabulary-edibles/" class="md-nav__link">
        Vocabulary edibles
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../economics/" class="md-nav__link">
        Economics
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#que-es" class="md-nav__link">
    Qué ès?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    Containers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imatges" class="md-nav__link">
    Imatges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environ" class="md-nav__link">
    Environ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multistage-build" class="md-nav__link">
    Multistage build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xarxa" class="md-nav__link">
    Xarxa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reinici-automatic" class="md-nav__link">
    Reinici automàtic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursos" class="md-nav__link">
    Recursos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumenes" class="md-nav__link">
    Volúmenes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicacion" class="md-nav__link">
    Publicacion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composicion-de-servicios" class="md-nav__link">
    Composición de servicios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#componiendo-para-multiples-entornos" class="md-nav__link">
    Componiendo para multiples entornos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking-en-compose" class="md-nav__link">
    Networking en compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-en-produccion" class="md-nav__link">
    Docker en producción?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consejos" class="md-nav__link">
    Consejos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-siempre-tengo-la-ultima-version" class="md-nav__link">
    - Siempre tengo la ultima version
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/vokimon/apunts/edit/master/docs/computers/docker.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="docker">Docker</h1>
<h2 id="que-es">Qué ès?</h2>
<p>Com les màquines virtuals serveix per aillar processos.
A diferència de les MV's, no duplica recursos.</p>
<p>Es basa en dues tecnologies de Linux:</p>
<ul>
<li>cgroups: per limitar els recursos (memoria, cpu...) dels processos</li>
<li>namespaces: Limita l'avast que pot veure el procés (altres processos, xarxa, sistema de fitxers...)</li>
</ul>
<p>Docker afegeix una capa per sobre:</p>
<ul>
<li>Aporta una forma uniforme de definir i accedir a les aplicacions</li>
</ul>
<h2 id="containers">Containers</h2>
<p>Creem una container interactiu (-it) de docker, basant-nos en una imatge d'Ubuntu.</p>
<ul>
<li>Imagen: definición de entorno (ficheros)<ul>
<li>Se identifican por un nombre</li>
<li>Se montan una encima de otra (podemos hacer una imagen de mysql encima de una de Ubuntu)</li>
<li>Hay un repositorio de imagenes construidas de donde bajarlas</li>
<li>También podemos crearla con un Dockerfile</li>
</ul>
</li>
<li>Container: instancia de una imagen<ul>
<li>Tienen un id</li>
<li>Puede estar encendida o apagada</li>
<li>Mantiene el estado entre encendidos si no la borramos</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker run -it ubuntu
</code></pre></div>
<ul>
<li>Executa una comanda dintre d'un sistema de fitxers "copiat" de la imatge.</li>
<li>Les modificacions que fem sobre el sistema de fitxers no afecten a altres instancies d'ubuntu que llencem.</li>
<li>Els processos que llencem a dintre son visibles des de el sistema pare, pero no al reves.</li>
<li>Quan termina el proces (en aquest cas es bash, per defecte) la imatge creada queda parada (no es destrueix)</li>
<li>Des de fora podem parar el process amb <code>docker stop 451bccb8de1c</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker ps -a  <span class="c1"># L&#39;opció -a es per veure tambe els que estan parats</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>CONTAINER ID   IMAGE    COMMAND   CREATED         STATUS                      PORTS     NAMES
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>5fabbdd99c65   ubuntu   <span class="s2">&quot;bash&quot;</span>    <span class="m">5</span> minutes ago   Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">5</span> minutes ago              heuristic_lamarr
</code></pre></div>
<p>Podem fer servir tant els id's com els noms per referir-nos a les instàncies.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>docker log 5fabbdd99c65 <span class="c1"># ens mostra la sortida estandard del procés principal, util sobretot si no l&#39;hem executat interactiu o hem sortit</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>docker log -f 5fabbdd99c65 <span class="c1"># &#39;follow&#39; sigue monitorizando lo que sale despues</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>docker stop 5fabbdd99c65
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>docker start -i 5fabbdd99c65 <span class="c1"># para arrancarlo otra vez</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>docker rm 5fabbdd99c65 <span class="c1"># para borrarlo definitivamente del sistema</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>docker run -it ubuntu <span class="c1"># volveria a arrancar uno diferente</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>docker <span class="nb">exec</span> -it 5fabbdd99c65 ls -alF
</code></pre></div>
<h2 id="imatges">Imatges</h2>
<p>Les imatges de partida les trobem a la web <a href="https://hub.docker.com/explore">Docker Hub</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker images <span class="c1"># Llista les imatges descarregades</span>
</code></pre></div>
<p>Las images tienen tags (versiones)</p>
<h2 id="dockerfile">Dockerfile</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">ADD</span><span class="w"> </span>mytarball.tar.gz
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">RUN</span><span class="w"> </span>tar xvfz mytarball.tar.gz
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">COPY</span><span class="w"> </span>file /var/www/html
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="err">&#39;/bi</span><span class="kc">n</span><span class="err">/bash&#39;</span><span class="p">]</span>
</code></pre></div>
<ul>
<li><code>FROM</code> es la imagen de base  imagen:tag</li>
<li><code>ADD</code> copia del sistema de ficheros local a dentro del container</li>
<li><code>RUN</code> ejecuta comando dentro del container</li>
<li><code>ENV</code> establece una variable de entorno para los comandos que se ejecuten (Sobrescribible desde fuera)</li>
<li><code>CMD</code> fija el comando inicial, es una array estilo argv (elemento por parametro)<ul>
<li>Sobreescribible por cli con el parametro del run</li>
</ul>
</li>
<li><code>ENTRYPOINT</code> fija el comando para arrancar el comando inicial <code>sh -c</code><ul>
<li>Sobreescribible por cli con <code>--entrypoint</code></li>
</ul>
</li>
<li><code>LABEL</code> metadata de la imagen  mylabel="value"<ul>
<li>maintaner, application...</li>
</ul>
</li>
<li><code>WORKDIR</code> cambia al directorio para los siguientes comandos</li>
</ul>
<p>Per a executar el Dockerfile</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>docker build -t myapp .
</code></pre></div>
<p>La imatge es dirà <em>myapp</em></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>docker run -it --rm myapp -p8000:80
</code></pre></div>
<ul>
<li>Per obrir i mapejar  ports -pOUTER:INNER</li>
<li>Per esborrar el container en acabar el run, <code>--rm</code></li>
<li><code>-f mydockerfile</code> si el fichero no se llama <code>Dockerfile</code> (por ejemplo para tener varios en un directorio)</li>
</ul>
<h2 id="environ">Environ</h2>
<p>Patron util usar las variables de entorno para modificar la configuración.</p>
<ul>
<li>Se usa ENV en el Dockfile para definir el valor por defecto</li>
<li>Se sobrescribe en CLI <code>docker run</code> con la opcion <code>-e VAR=value</code></li>
<li>Los programas lo cogen usando </li>
<li>Se usa en los ficheros copiados substituyendo ${VAR}</li>
</ul>
<h2 id="cache">Cache</h2>
<ul>
<li>Docker crea capas cada comando sacando el checksum como id.</li>
<li>Se reaprovechan los pasos de anteriores ejecuciones.</li>
<li>Interesa poner abajo los comandos que más a menudo vayan a alterar la imagen.</li>
<li>Puede interesarnos juntar varias sentencias RUN con <code>&amp;&amp;</code> para reducir las capas</li>
</ul>
<h2 id="multistage-build">Multistage build</h2>
<p>Útil per a no incloure a la imatge final tot el que cal per construir l'aplicació,
com ara l'es eines de build i les dependencies de desenvolupament (composer, babel, cython...).</p>
<ul>
<li>Tamany: Ocupa menys</li>
<li>Seguretat: Es redueix la superficie d'atac</li>
</ul>
<p>Construim l'aplicació en una imatge i després copiem els fitxers construits a l'imatge final.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c"># Partim d&#39;una imatge amb les eines de construcció</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">composer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">dependencies</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c"># Copiem nomes els fitxers de dependències</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">COPY</span><span class="w"> </span>dependencies.json /app
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="k">RUN</span><span class="w"> </span>make dependencies
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c"># Fins aquí la imatge no depén del nostre codi</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="k">COPY</span><span class="w"> </span>. /app
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="k">RUN</span><span class="w"> </span>make build
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="c"># Inclou l&#39;aplicació muntada pero també les eines de construccio</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="c"># Creem una nova imatge neta</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="c"># Copiem no des del host sino de la imatge inicial</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="k">COPY</span><span class="w"> </span>--from dependencies dist/ /var/www/html
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="k">RUN</span><span class="w"> </span>...
</code></pre></div>
<h2 id="xarxa">Xarxa</h2>
<p>Els ports d'escolta del container no son visibles a l'exterior per defecte.
Tampoc colisionen, que això es bó.</p>
<p>Un Dockerfile defineix un port publicable amb <code>EXPOSE</code>, pe <code>EXPOSE 80</code>.
Això vol dir que podem mapejar aquest port a un port del host.</p>
<p>L'opció <code>-P</code> mapeja tots els ports exposats a ports aleatoris del host.
Podem esbrinar els ports mapejats amb <code>docker ps</code>.</p>
<p>Normalment volem exposar-ho a un port concret: run amb <code>-p hostport:containerport</code>
Si no ponem un <code>OUTER:</code>, s'assignen ports aleatoris.</p>
<p>Els ports exposats s'hereten.
Per exemple, les imatges oficials d'apache exposen el port 80.
Els docker de que depenen de la imatge d'apache tambe el tindran.</p>
<h2 id="reinici-automatic">Reinici automàtic</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>composer run --restart<span class="o">=</span>no<span class="p">|</span>always<span class="p">|</span>onfailure:3<span class="p">|</span>unless-stop
</code></pre></div>
<h2 id="recursos">Recursos</h2>
<ul>
<li><code>--memory 4g</code> Mata el proceso cuando se pasa</li>
<li><code>--cpus 1.5</code> Reserva como maximo ese slot de cpu (multiproceso)</li>
<li><code>--cpu-shares N</code> peso para repartir la CPU si hay escasez (1024 defecto)</li>
</ul>
<h2 id="volumenes">Volúmenes</h2>
<p>Util para mantener el estado entre ejecuciones.
Por ejemplo las bases de datos, uploads...
Son directorios que se montan en las imagenes.</p>
<p>Tambien es muy util para montar el codigo en desarrollo
para acelerar el flujo de desarrollo.</p>
<ul>
<li><code>-v /data</code> crea una carpeta random</li>
<li><code>-v volumename:/data</code> reusa un volumne por nombre</li>
<li><code>-v ruta/:/data</code> reusa un volumne por path</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>docker volume ls <span class="c1"># lista los volumentes</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>docker volume create name <span class="c1">#  crea un volumen especifico</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>docker inspect -f  <span class="s2">&quot;{{json .Mounts}}&quot;</span> my-app  <span class="c1"># Lista los volumenes montados por el container my-app</span>
</code></pre></div>
<p>Por defecto los guarda en un directorio de docker (var/lib/docker/).
Podemos especificar el directorio que montamos.</p>
<p>Tambien se puede especificar el VOLUME en el Dockerfile.
En ese caso, si no le especificamos nada, docker lo creara
donde crea los dockers aunque no digamos nada en cli.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">VOLUME</span><span class="w"> </span>
</code></pre></div>
<h2 id="publicacion">Publicacion</h2>
<p>Crear una cuenta en docker hub.
En settings linkad con la cuenta del repo (github, bitbucket...).</p>
<h2 id="composicion-de-servicios">Composición de servicios</h2>
<p><code>docker-compose</code> es una capa por encima de docker
que agrupa diversos contenedores en una aplicación
especificando los parametros con los que llamariamos a <code>docker run</code>.</p>
<p>Se define en el </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># docker-compose.yaml</span><span class="w"></span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.3</span><span class="w"></span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nt">services</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">myservice</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="nt">images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span><span class="w">         </span><span class="c1"># Esta imagen la toma tal cual</span><span class="w"></span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">               </span><span class="c1"># Monta el directorio actual en /var/www/html</span><span class="w"></span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-${PWD}:/var/www/html</span><span class="w"></span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000:80</span><span class="w"></span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">  </span><span class="nt">myapp</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">                   </span><span class="c1"># Esta imagen es construida</span><span class="w"></span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${PWD}</span><span class="w">           </span><span class="c1"># Path en el que se construira la imagen, tomamos PWD del entorno de usuario</span><span class="w"></span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span><span class="w">    </span><span class="c1"># Fichero Dockerfile para construir la imagen</span><span class="w"></span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">                   </span><span class="c1"># Expondra el puerto 80 interno como 8001 en localhost</span><span class="w"></span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8001:80</span><span class="w"></span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">             </span><span class="c1"># Pasara estas variables de entorno</span><span class="w"></span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR=value</span><span class="w"></span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"> </span><span class="c1"># Esperara a que el otro servicio este levantado</span><span class="w"></span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myservice</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>docker-compose up -d 
</code></pre></div>
<ul>
<li><code>-d</code> para detach (background)</li>
</ul>
<p>Ofrece comandos que se aplican a la vez a todos los containers definidos en el fichero:</p>
<ul>
<li><code>docker-compose ps</code> Estado de los containers</li>
<li><code>docker-compose log</code> Salida combinada de los containers</li>
<li><code>docker-compose top</code> Top de procesos en los containers</li>
<li><code>docker-compose stop</code> Para los procesos pero sin eliminarlos</li>
<li><code>docker-compose down</code> Elimina los contenedores</li>
<li><code>docker-compose build</code> Solo construye las imagenes</li>
</ul>
<p>La imagen construida se llama por defecto, como el directorio y el nombre del servicio: <code>myproject_myapp</code>.</p>
<ul>
<li><code>myproject</code> por el directorio en el que está el yaml</li>
<li><code>myapp</code> por la etiqueta del servicio</li>
</ul>
<p>Las siguientes ejecuciones reusan la imagen creada.
Hace falta forzar con <code>docker-compose up --build</code></p>
<h2 id="componiendo-para-multiples-entornos">Componiendo para multiples entornos</h2>
<p>No es buena idea hardcodear el environment en el compose</p>
<ul>
<li>Cambiar de tipo de entorno: devel, testing, prod...</li>
<li>Secrets en el repositorio!</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR</span><span class="w">  </span><span class="c1"># No igualamos a nada, se coge del entorno</span><span class="w"></span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</code></pre></div>
<h2 id="networking-en-compose">Networking en compose</h2>
<p>Por defecto, con <code>docker-compose</code> cada docker tiene su propia red.
Para que dos contenedores se vean, tienen que estar en la misma red.
Podemos crear redes y mover contenedores entre ellas.
En ese caso, el nombre de contenedor hace de servername.</p>
<p>Utilidades de red:</p>
<ul>
<li><code>docker network ls</code></li>
<li><code>docker network create NETWORK</code></li>
<li><code>docker network connect NETWORK CONTAINER</code></li>
<li><code>docker network disconnect NETWORK CONTAINER</code></li>
</ul>
<p>Los servicios en un docker-compose se levantan, por defecto, como hosts diferentes de la misma red local <code>default</code>.
Los composers se ven entre ellos usando como dns el nombre del servicio.
Pero podemos crear estructuras de red mas complejas.
Todos los contenedores se ven entre ellos si comparten red.</p>
<p>Cada servicio define sus <code>networks</code> cuando queremos no ponerlas en <code>default</code>:</p>
<ul>
<li>Las aplicaciones solo se pueden ver si tienen una red en común.</li>
<li>Esto permite aislar servicios para más seguridad</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nn">...</span><span class="w"></span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nt">services</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nt">myservice</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">networks</span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mynetwork</span><span class="w"></span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="nt">mynetwork</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">  </span><span class="nt">myexistingnetwork</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w">    </span><span class="c1"># creada fuera del docker-compose con docker-network</span><span class="w"></span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myothernetwork</span><span class="w"></span>
</code></pre></div>
<h2 id="docker-en-produccion">Docker en producción?</h2>
<ul>
<li>No es conveniente montar el docker compose con servicios que necesitan persistència.</li>
<li>Con docker-compose no podemos distribuir servicios. Para hacerlo asi necesitariamos herramientas tipo Kubernetes.</li>
<li>Si que puede ser útil montar el docker de la aplicación</li>
</ul>
<h2 id="consejos">Consejos</h2>
<ul>
<li>Usar imagenes oficiales<ul>
<li>se ha trabajado en ellas para que ocupen lo menos posible</li>
<li>al final lo importante es la version del servicio, no que OS hay por debajo</li>
<li>perdemos la cache entre imagenes si son OS distinto</li>
</ul>
</li>
<li>Usar la latest<h2 id="-siempre-tengo-la-ultima-version">- Siempre tengo la ultima version</h2>
</li>
<li>links vs dependson:<ul>
<li>links deprecado, decia que container habla con cual, con networks + dependson</li>
</ul>
</li>
<li>ip's<ul>
<li>Las ips no tienen porque mantenerse, mejor usar los nombres</li>
</ul>
</li>
<li>docker no espera a que el servicio esta disponilbe, simplemente la maquina<ul>
<li>diseño aplicaciones capaces de resistir a caida de servicios</li>
<li>scripts para esperar que el servicio este levantado</li>
</ul>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../deeplearning/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Deep learning" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deep learning
            </div>
          </div>
        </a>
      
      
        
        <a href="../ip6" class="md-footer__link md-footer__link--next" aria-label="Next: None" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              None
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>